<div class="lead-wrapper">

    <!-- ================= LEAD LIST ================= -->
    <div class="lead-card" *ngIf="showLeads">

        <div class="header">
            <h2>Lead List</h2>

            <button class="toggle-btn" (click)="openCreate()">
                + Add Lead
            </button>
        </div>

        <!-- FILTERS -->
        <div class="filters">
            <input type="date" [(ngModel)]="filterFromDate" (change)="applyFilters()" />
            <input type="date" [(ngModel)]="filterToDate" (change)="applyFilters()" />

            <select [(ngModel)]="filterStatus" (change)="applyFilters()">
                <option value="">Status</option>
                <option value="1">Active</option>
                <option value="0">Inactive</option>
            </select>

            <button type="button" class="clear-btn" (click)="clearFilters()">Clear</button>
        </div>

        <table class="lead-table" *ngIf="paginatedLeads.length; else noData">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Customer</th>
                    <th>Contact</th>
                    <th>Email</th>
                    <th>Budget</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let l of paginatedLeads; let i = index">
                    <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
                    <td>{{ l.cname }}</td>
                    <td>{{ l.contactNo }}</td>
                    <td>{{ l.email }}</td>
                    <td>â‚¹ {{ l.budget | number }}</td>
                    <td>
                        <span class="badge" [ngClass]="l.isActive ? 'active' : 'inactive'">
                            {{ l.isActive ? 'Active' : 'Inactive' }}
                        </span>
                    </td>
                    <td>
                        <button class="edit-btn" (click)="editLead(l)">Edit</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="pagination" *ngIf="totalPages > 1">
            <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>
            <span>Page {{ currentPage }} of {{ totalPages }}</span>
            <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
        </div>

        <ng-template #noData>
            <p class="no-data">No leads found</p>
        </ng-template>
    </div>

    <!-- ================= CREATE / EDIT LEAD ================= -->
    <div class="lead-card" *ngIf="!showLeads">

        <div class="header">
            <h2>{{ isEditMode ? 'Edit Lead' : 'Create Lead' }}</h2>

            <button class="toggle-btn" (click)="backToList()">
                Back to List
            </button>
        </div>

        <form [formGroup]="form" (ngSubmit)="submit()">

            <div class="grid">

                <div class="field floating">
                    <input type="date" formControlName="date" placeholder=" " />
                    <label>Date *</label>
                </div>

                <div class="field floating">
                    <input formControlName="cName" placeholder=" " />
                    <label>Customer Name *</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="contactNo" placeholder=" " />
                    <label>Contact No *</label>
                </div>

                <div class="field floating">
                    <input formControlName="email" placeholder=" " />
                    <label>Email</label>
                </div>

                <div class="field floating">
                    <input formControlName="website" placeholder=" " />
                    <label>Website</label>
                </div>

                <div class="field floating">
                    <input formControlName="panNo" placeholder=" " />
                    <label>PAN No *</label>

                    <small class="error" *ngIf="form.get('panNo')?.hasError('invalidPan')">
                        Invalid PAN format
                    </small>

                    <small class="error" *ngIf="form.get('panNo')?.hasError('duplicate')">
                        PAN already exists
                    </small>
                </div>

                <div class="field floating">
                    <input formControlName="gstNo" placeholder=" " />
                    <label>GST No</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="phone" placeholder=" " />
                    <label>Phone</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="fax" placeholder=" " />
                    <label>Fax</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="income" placeholder=" " />
                    <label>Income</label>
                </div>

                <div class="field floating">
                    <input formControlName="incomeSource" placeholder=" " />
                    <label>Income Source</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="otherIncome" placeholder=" " />
                    <label>Other Income</label>
                </div>

                <div class="field floating">
                    <input formControlName="otherIncomeSource" placeholder=" " />
                    <label>Other Income Source</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="budget" placeholder=" " />
                    <label>Budget *</label>
                </div>

                <div class="field floating">
                    <input formControlName="area" placeholder=" " />
                    <label>Area</label>
                </div>

                <div class="field floating">
                    <select formControlName="stateId" (change)="onStateChange()">
                        <option [ngValue]="null" disabled></option>
                        <option *ngFor="let s of states" [ngValue]="s.id">{{ s.name }}</option>
                    </select>
                    <label>State *</label>
                </div>

                <div class="field floating">
                    <select formControlName="distId" (change)="onDistrictChange()">
                        <option [ngValue]="null" disabled></option>
                        <option *ngFor="let d of districts" [ngValue]="d.id">{{ d.name }}</option>
                    </select>
                    <label>District *</label>
                </div>

                <div class="field floating">
                    <select formControlName="cityId">
                        <option [ngValue]="null" disabled></option>
                        <option *ngFor="let c of cities" [ngValue]="c.id">{{ c.name }}</option>
                    </select>
                    <label>City *</label>
                </div>

                <div class="field floating">
                    <select formControlName="isActive">
                        <option [ngValue]="1">Active</option>
                        <option [ngValue]="0">Inactive</option>
                    </select>
                    <label>Status</label>
                </div>

                <div class="field floating">
                    <textarea rows="1" formControlName="invoiceAddress" placeholder=" "></textarea>
                    <label>Invoice Address</label>
                </div>

                <div class="field floating full">
                    <textarea rows="2" formControlName="notes" placeholder=" "></textarea>
                    <label>Notes</label>
                </div>

            </div>

            <div class="actions">
                <button type="submit" [disabled]="loading">
                    {{ loading ? 'Saving...' : (isEditMode ? 'Update Lead' : 'Save Lead') }}
                </button>
            </div>

        </form>
    </div>

</div>