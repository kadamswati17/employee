<div class="lead-wrapper">

    <!-- ================= CREATE / EDIT LEAD ================= -->
    <div class="lead-card" *ngIf="!showLeads">

        <!-- HEADER -->
        <div class="header">
            <h2>{{ isEditMode ? 'Edit Lead' : 'Create Lead' }}</h2>

            <button class="toggle-btn" (click)="toggleLeads()">
                Show Lead List
            </button>
        </div>

        <!-- FORM -->
        <form [formGroup]="form" (ngSubmit)="submit()">

            <div class="grid">

                <div class="field floating">
                    <input type="date" formControlName="date" />
                    <label>Date</label>
                </div>

                <div class="field floating">
                    <input formControlName="cName" />
                    <label>Customer Name *</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="contactNo" />
                    <label>Contact No *</label>
                </div>

                <div class="field floating">
                    <input formControlName="email" />
                    <label>Email</label>
                </div>

                <div class="field floating">
                    <input formControlName="website" />
                    <label>Website</label>
                </div>

                <div class="field floating">
                    <input formControlName="panNo" />
                    <label>PAN No *</label>

                    <small class="error" *ngIf="form.get('panNo')?.hasError('invalidPan')">
                        Invalid PAN format
                    </small>

                    <small class="error" *ngIf="form.get('panNo')?.hasError('duplicate')">
                        PAN already exists
                    </small>
                </div>

                <div class="field floating">
                    <input formControlName="gstNo" />
                    <label>GST No</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="phone" />
                    <label>Phone</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="fax" />
                    <label>Fax</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="income" />
                    <label>Income</label>
                </div>

                <div class="field floating">
                    <input formControlName="incomeSource" />
                    <label>Income Source</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="otherIncome" />
                    <label>Other Income</label>
                </div>

                <div class="field floating">
                    <input formControlName="otherIncomeSource" />
                    <label>Other Income Source</label>
                </div>

                <div class="field floating">
                    <input type="number" formControlName="budget" />
                    <label>Budget *</label>
                </div>

                <div class="field floating">
                    <input formControlName="area" />
                    <label>Area</label>
                </div>

                <div class="field floating">
                    <select formControlName="stateId" (change)="onStateChange()">
                        <option [ngValue]="null" disabled>Select State</option>
                        <option *ngFor="let s of states" [ngValue]="s.id">{{ s.name }}</option>
                    </select>
                    <label>State *</label>
                </div>

                <div class="field floating">
                    <select formControlName="distId" (change)="onDistrictChange()">
                        <option [ngValue]="null" disabled>Select District</option>
                        <option *ngFor="let d of districts" [ngValue]="d.id">{{ d.name }}</option>
                    </select>
                    <label>District *</label>
                </div>

                <div class="field floating">
                    <select formControlName="cityId">
                        <option [ngValue]="null" disabled>Select City</option>
                        <option *ngFor="let c of cities" [ngValue]="c.id">{{ c.name }}</option>
                    </select>
                    <label>City *</label>
                </div>

                <div class="field floating">
                    <select formControlName="isActive">
                        <option [ngValue]="1">Active</option>
                        <option [ngValue]="0">Inactive</option>
                    </select>
                    <label>Status</label>
                </div>

                <div class="field floating ">
                    <textarea rows="1" formControlName="invoiceAddress"></textarea>
                    <label>Invoice Address</label>
                </div>

                <div class="field floating full">
                    <textarea rows="2" formControlName="notes"></textarea>
                    <label>Notes</label>
                </div>

            </div>

            <div class="actions">
                <button type="submit" [disabled]="loading">
                    {{ isEditMode ? 'Update Lead' : 'Save Lead' }}
                </button>
            </div>

        </form>
    </div>

    <!-- ================= LEAD LIST ================= -->
    <div class="lead-card mt" *ngIf="showLeads">

        <div class="header header-flex">
            <h3 class="list-title">Lead List</h3>

            <div class="filters">
                <input type="date" [(ngModel)]="filterFromDate" (change)="applyFilters()" />
                <input type="date" [(ngModel)]="filterToDate" (change)="applyFilters()" />

                <select [(ngModel)]="filterStatus" (change)="applyFilters()">
                    <option value="">Status</option>
                    <option value="1">Active</option>
                    <option value="0">Inactive</option>
                </select>

                <button class="clear-btn" (click)="clearFilters()">Clear</button>
                <button class="toggle-btn" (click)="toggleLeads()">Back</button>
            </div>
        </div>

        <table class="lead-table" *ngIf="filteredLeads.length; else noData">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Contact</th>
                    <!-- <th>Email</th> -->
                    <th>PAN</th>
                    <th>Budget</th>
                    <!-- <th>State</th> -->
                    <!-- <th>District</th> -->
                    <!-- <th>City</th> -->
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let l of filteredLeads; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ l.date | date }}</td>
                    <td>{{ l.cname }}</td>
                    <td>{{ l.contactNo }}</td>
                    <!-- <td>{{ l.email }}</td> -->
                    <td>{{ l.panNo }}</td>
                    <td>â‚¹ {{ l.budget | number }}</td>
                    <!-- <td>{{ l.stateName }}</td> -->
                    <!-- <td>{{ l.districtName }}</td> -->
                    <!-- <td>{{ l.cityName }}</td> -->
                    <td>
                        <span class="badge" [ngClass]="l.isActive ? 'active' : 'inactive'">
                            {{ l.isActive ? 'Active' : 'Inactive' }}
                        </span>
                    </td>
                    <td>
                        <button class="edit-btn" (click)="editLead(l)">Edit</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <ng-template #noData>
            <p class="no-data">No leads found</p>
        </ng-template>

    </div>

</div>