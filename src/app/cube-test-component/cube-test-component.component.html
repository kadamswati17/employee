<div class="lead-wrapper">

    <div class="lead-card" *ngIf="showLeads">

        <div class="header">
            <h2 class="title">Cube Test List</h2>
            <button class="toggle-btn" (click)="openCreate()">+ Add</button>
        </div>

        <div class="filters">

            <div class="date-field top-label">
                <label>From Date</label>
                <input type="date" [(ngModel)]="filterFromDate" (change)="applyFilters()" />
            </div>

            <div class="date-field top-label">
                <label>To Date</label>
                <input type="date" [(ngModel)]="filterToDate" (change)="applyFilters()" />
            </div>

            <select (change)="onExportChange($event)">
                <option value="">Export</option>
                <option value="pdf">Export PDF</option>
                <option value="excel">Export Excel</option>
            </select>
            <!-- IMPORT SELECT -->
            <!-- <select (change)="onImportSelect($event)">
                <option value="">Import</option>
                <option value="excel">Import Excel</option>
            </select> -->

            <!-- HIDDEN FILE INPUT -->
            <input type="file" accept=".xlsx,.xls" hidden #fileInput (change)="onExcelSelect($event)" />
            <select [(ngModel)]="filterShift" (change)="applyFilters()">
                <option value="">All Shifts</option>
                <option value="1">Shift 1</option>
                <option value="2">Shift 2</option>
                <option value="3">Shift 3</option>
                <option value="G">General</option>
            </select>



            <button class="clear-btn" (click)="clearFilters()">Clear</button>
        </div>

        <div class="table-scroll">
            <table class="lead-table">

                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Batch_Casting Date</th>
                        <th>Test Date</th>
                        <th>Strength Over Dry</th>
                        <th>Cube Immediate</th>
                        <th>Density</th>
                        <th>Shift</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let r of paginated">
                        <td>{{ r.id }}</td>
                        <td>
                            {{ r.batchNo }}_{{ r.castDate | date:'dd-MM-yyyy' }}
                        </td>




                        <td>{{ r.testingDate | date:'dd-MM-yyyy' }}</td>
                        <td>{{r.compStrengthOverDry}}</td>
                        <td>{{r.cubeDimensionImmediate}}</td>
                        <td>{{r.densityKgM3}}</td>
                        <td>{{ r.shift }}</td>

                        <td>
                            <span class="badge" [ngClass]="r.isActive ? 'active':'inactive'">
                                {{ r.isActive ? 'Active':'Inactive' }}
                            </span>
                        </td>

                        <td class="action-cell">
                            <button class="link-btn" (click)="edit(r)">Edit</button>
                            <button class="link-btn danger" (click)="delete(r.id)">Delete</button>
                        </td>

                    </tr>
                </tbody>

            </table>

        </div>

        <div class="pagination">
            <button (click)="prevPage()">Prev</button>
            <span>{{currentPage}} / {{totalPages}}</span>
            <button (click)="nextPage()">Next</button>
        </div>

    </div>

    <!-- ================= FORM ================= -->

    <div class="lead-card" *ngIf="!showLeads">

        <form [formGroup]="form" (ngSubmit)="submit()">

            <div class="row-header">

                <div class="page-title1">Cube Test</div>

                <div class="header-right">

                    <div class="form-field date">
                        <input type="date" formControlName="reportDate">

                        <label>Date</label>
                    </div>

                    <div class="form-field shift">
                        <select formControlName="shift">
                            <option value="" disabled></option>
                            <option value="1">Shift 1</option>
                            <option value="2">Shift 2</option>
                            <option value="3">Shift 3</option>
                            <option value="G">General Shift</option>
                        </select>
                        <label>Shift</label>
                    </div>

                </div>

            </div>

            <hr>
            <div class="grid">
                <!-- Batch Dropdown -->
                <div class="form-field">

                    <select formControlName="batchNo" (change)="onBatchSelect($event)">
                        <option value="">Select Batch</option>

                        <option *ngFor="let b of batches" [value]="b.batchNumber">
                            {{ b.batchNumber }}_{{ b.castingDate | date:'dd-MM-yyyy' }}
                        </option>

                    </select>

                    <label>Batch No</label>
                </div>

                <!-- hidden castDate -->
                <input type="hidden" formControlName="castDate">


                <div class="form-field">
                    <input type="date" formControlName="testingDate">
                    <label>Testing Date</label>
                </div>

                <div class="form-field">
                    <input formControlName="cubeDimensionImmediate">
                    <label>Cube Immediate</label>
                </div>

                <div class="form-field">
                    <input formControlName="cubeDimensionOverDry">
                    <label>Cube Over Dry</label>
                </div>

                <div class="form-field">
                    <input formControlName="weightImmediateKg">
                    <label>Weight Immediate</label>
                </div>

                <div class="form-field">
                    <input formControlName="weightOverDryKg">
                    <label>Weight Over Dry</label>
                </div>

                <div class="form-field">
                    <input formControlName="weightWithMoistureKg">
                    <label>Weight Moisture</label>
                </div>

                <div class="form-field">
                    <input formControlName="loadOverDryTonn">
                    <label>Load Over Dry</label>
                </div>

                <div class="form-field">
                    <input formControlName="loadMoistureTonn">
                    <label>Load Moisture</label>
                </div>

                <div class="form-field">
                    <input formControlName="compStrengthOverDry">
                    <label>Strength Over Dry</label>
                </div>

                <div class="form-field">
                    <input formControlName="compStrengthMoisture">
                    <label>Strength Moisture</label>
                </div>

                <div class="form-field">
                    <input formControlName="densityKgM3">
                    <label>Density</label>
                </div>

            </div>


            <div class="actions">
                <button type="submit">Save</button>
                <button type="button" (click)="backToList()">Back</button>
            </div>

        </form>

    </div>

</div>